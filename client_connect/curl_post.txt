# To make a POST request with curl, we send data that is usually sent by form. 
# We need to specify the various fields of the form and their value

FORM fields: 
"upload_action=upload" "folder=" "MAX_FILE_SIZE=20971520" 
"artist=-2" "album=-2" "upl=FILENAME"

# General curl command:
curl -X POST -F 'field_name=field_value' 'field2=value2' http://172.24.4.71:80/upload.php

# Uploading files:
To POST a file with curl, simply add the @ symbol before the file location. The file can be an archive, image, document, etc.

To be able to POST as a logged in user, use cookies:
--cookie "ampache=jttmt3g11rlp3mpe72eu3eia05; ampache_user=admin; ampache_lang=en_US; jp_volume=1"

curl -X POST --cookie "ampache=jttmt3g11rlp3mpe72eu3eia05; ampache_user=admin; ampache_lang=en_US; jp_volume=1" -F 'upload_action=upload' -F 'folder=' -F 'MAX_FILE_SIZE=20971520' -F 'artist=-2' -F 'album=-2' -F 'upl=' -F 'filename=Mozart-Serenade-in-G-major.mp3' http://172.24.4.71:80/upload.php


KINDA WORKS (it creates the file and the db entry, but the file is actually empty - and it is sent as Content-Type streaming-octet
curl -X POST --cookie "ampache=jttmt3g11rlp3mpe72eu3eia05; ampache_user=admin; ampache_lang=en_US; jp_volume=1" -F 'upload_action=upload' 
-F 'folder=' -F 'MAX_FILE_SIZE=20971520' -F 'artist=-2' -F 'album=-2' -F 'upl=; filename=Mozart-Serenade-in-G-major.mp3;type=audio/mpeg'
-F "@Mozart....mp3" http://172.24.4.71:80/upload.php

To see what does the command do, run this on the webserver: 
sudo tcpdump -i ens3 'port 80' -A 

curl -X POST 
--cookie "ampache=7cug0uvbthr73tvpe4537tglps; ampache_user=admin; ampache_lang=en_US; jp_volume=1"  
or --cookie "ampache=nme3442dik48mkvuotatubmt8e; ampache_user=geo; ampache_lang=en_US; jp_volume=1"



curl -i -X POST \
--cookie "ampache=nme3442dik48mkvuotatubmt8e; ampache_user=geo; ampache_lang=en_US; jp_volume=1" \
-F "upload_action=upload" -F "folder=" -F "MAX_FILE_SIZE=20971520" -F "artist=-2" -F "album=-2" \
-F "upl=; filename=Mozart-Serenade-in-G-major.mp3;type=audio/mpeg"
-F "file=@Mozart-Serenade-in-G-major.mp3" http://172.24.4.81:80/upload.php

LOGIN
In order to understand how to perform these commands from terminal, I first of all perform them from 
the web interface and listen to the traffic with tcpdump on the web server: 
sudo tcpdump -i ens3 port 80 -w file.pcap
I look at the interaction and get the cookies, in order to use them in the curl commands. 
(if we want to automatize the process, we can do it in python with scapy probably)
I also listen to the traffic generated by command line and compare it with the 
one generated by the user interface, to understand it everything is working correctly

E.g. these data was taken from the third packet of the login.pcap file: 
curl -X POST -H "Content-Type: multipart/form-data"  \
--cookie "ampache=k57f2ein2mm1h32sv6ms2hsbqp" \
-F "username=eval" -F "password=eval"  \
-F "referrer=" -F "action=login" \
http://172.24.4.236:80/site/login.php 

Then the cookie was updated after the curl command. This data was taken from login_curl.pcap: 
curl --cookie "ampache=mpdskv3mb5do8hrg5kbrhlbk81; ampache_user=geo; ampache_lang=en_US; " http://172.24.4.81:80/index.php

curl --cookie "ampache=29s50dbdet6gir3fl50eljshg3; ampache_user=eval;  ampache_lang=en_US; ROUTEPATH=.1; \
http://172.24.4.236:80/site/index.php#browse.php?action=playlist


UPLOAD
curl -X POST --cookie "ampache=3pfplp1mi2udappqld56n5s4p9; ampache_user=admin; ampache_lang=en_US; jp_volume=1" \
-F "upload_action=upload" -F "folder=" -F "MAX_FILE_SIZE=20971520" -F "artist=-2" -F "album=-2" \
-F "upl=; filename=@Mozart-Serenade-in-G-major.mp3;type=audio/mpeg" \
http://172.24.4.81:80/upload.php


UPLOAD
curl -X POST-H "Content-Type: multipart/form-data"  --cookie "ampache=3pfplp1mi2udappqld56n5s4p9; ampache_user=admin; ampache_lang=en_US; jp_volume=1" \
-F "upload_action=upload" -F "folder=" -F "MAX_FILE_SIZE=20971520" -F "artist=-2" -F "album=-2" -F \
 "upl=; filename=@Mozart-Serenade-in-G-major.mp3;type=audio/mpeg" \
 http://172.24.4.81:80/index.php#upload.php

--data "/home/georgiana.bud/project/music/Mozart-Serenade-in-G-major.mp3" \

ADMIN:
ampache=3pfplp1mi2udappqld56n5s4p9
GEO:ampache=mpdskv3mb5do8hrg5kbrhlbk81
